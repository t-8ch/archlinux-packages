# Maintainer: Thomas Wei√üschuh <thomas_weissschuh lavabit com>
# Contributor: zoulnix <http://goo.gl/HQaP>

pkgname=ultrastardx-svn
pkgver=2891
pkgrel=1
pkgdesc='free and open source karaoke game.'
arch=('i686' 'x86_64')
url="http://ultrastardeluxe.org/"
license=('GPL')
depends=('ffmpeg' 'lua' 'portaudio' 'sdl_image' 'sqlite3' 'ttf-dejavu' 'ttf-freefont' 'wqy-microhei')
makedepends=('fpc')
options=('!libtool')
provides=('ultrastardx')
conflicts=('ultrastardx')
groups=('usdx')

_svnmod="ultrastardx"
_svntrunk="https://ultrastardx.svn.sourceforge.net/svnroot/ultrastardx/trunk"

build() {
  cd ${srcdir}

  #####
  msg "Getting sources..."
  if [ -d ${_svnmod}/.svn ]; then
    cd ${_svnmod} && svn up -r ${pkgver}
  else
    svn co ${_svntrunk} --config-dir ./ -r ${pkgver} ${_svnmod}
    cd ${_svnmod}
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."
  #####


  ./configure --prefix=/usr \
              --sysconfdir=/etc \
              --localstatedir=/var \
              --disable-static

  LDFLAGS="" make
}

package() {
  cd ${srcdir}/${_svnmod}
  install -d ${pkgdir}/usr/share/{applications,pixmaps}

  make DESTDIR=${pkgdir} install

  rm ${pkgdir}/usr/share/${_svnmod}/fonts/*/*.tt*

  install -m644 dists/${_svnmod}.desktop \
                ${pkgdir}/usr/share/applications/
  install -m644 ${pkgdir}/usr/share/${_svnmod}/resources/icons/${_svnmod}-icon.png \
                ${pkgdir}/usr/share/pixmaps/${_svnmod}.png

#  # symlink fonts...
  ln -s /usr/share/fonts/TTF/DejaVuSans.ttf ${pkgdir}/usr/share/${_svnmod}/fonts/DejaVu/
  ln -s /usr/share/fonts/TTF/DejaVuSans-Bold.ttf ${pkgdir}/usr/share/${_svnmod}/fonts/DejaVu/
  ln -s /usr/share/fonts/TTF/FreeSans.ttf ${pkgdir}/usr/share/${_svnmod}/fonts/FreeSans/
  ln -s /usr/share/fonts/TTF/FreeSansBold.ttf ${pkgdir}/usr/share/${_svnmod}/fonts/FreeSans/
  ln -s /usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc ${pkgdir}/usr/share/${_svnmod}/fonts/wqy-microhei/
}
